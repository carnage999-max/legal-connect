# Supervisor configuration for Django backend and PM2 frontend
# This file should be placed at /etc/supervisor/conf.d/legal-connect.conf

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

# Django/Gunicorn Backend Service
[program:legal-connect-backend]
directory=/home/ubuntu/legal-connect/backend
command=/home/ubuntu/legal-connect/backend/env/bin/gunicorn \
    --workers 2 \
    --worker-class sync \
    --bind 127.0.0.1:8000 \
    --timeout 60 \
    --max-requests 1000 \
    --max-requests-jitter 50 \
    --access-logfile - \
    --error-logfile - \
    legal_connect.wsgi:application

user=ubuntu
autostart=true
autorestart=true
startsecs=10
stopasgroup=true
killasgroup=true

# Logging
stderr_logfile=/var/log/legal-connect/backend.err.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5
stdout_logfile=/var/log/legal-connect/backend.out.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5

# Environment
environment=PATH="/home/ubuntu/legal-connect/backend/env/bin",HOME="/home/ubuntu",PYTHONUNBUFFERED="1"

# Process monitoring
stopsignal=QUIT
stopwaitsecs=10

# Group configuration
[group:legal-connect]
programs=legal-connect-backend
priority=999
